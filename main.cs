using Mutagen.Bethesda;
using Mutagen.Bethesda.Skyrim;
using Mutagen.Bethesda.Synthesis;

namespace ReProccer;
static class Executor
{
    internal static Lazy<Config.SettingsUI> SettingsUI = new();
    internal static readonly Lazy<Config.General> General = new();

    internal static IPatcherState<ISkyrimMod, ISkyrimModGetter>? State;

    // entry point
    public static async Task<int> Main(string[] args)
    {
        return await SynthesisPipeline.Instance
        .AddPatch<ISkyrimMod, ISkyrimModGetter>(Initialize)
        .SetAutogeneratedSettings("ReProccer Evolved", "settings/settings.json", out SettingsUI)
        .SetTypicalOpen(GameRelease.SkyrimSE, $"{General.Value.PatchName}.esp")
        .Run(args);
    }

    // init process
    public static void Initialize(IPatcherState<ISkyrimMod, ISkyrimModGetter> patcherState)
    {
        Console.WriteLine("");

        // getting state
        State = patcherState;
    }
}